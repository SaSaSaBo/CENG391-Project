<?php
include "connection.php";

// Silme işlemi
if (isset($_POST['delete_button'])) {
    // Form is submitted, get the id_to_delete value
    $id_to_delete = isset($_POST['id_to_delete']) ? $_POST['id_to_delete'] : '';

    // $id_to_delete değerini kontrol et
    if (!empty($id_to_delete)) {
        // Silme sorgusu
        $sql_delete = "DELETE FROM course WHERE CourseID = $id_to_delete";

        // Sorguyu ekrana yazdır
        echo "Sorgu: " . $sql_delete . "<br>";

        if ($connection->query($sql_delete) === TRUE) {
            echo "<script>alert('Course successfully deleted.');</script>";
        } else {
            // Hata detaylarını ekrana yazdır
            echo "Hata: " . $connection->error . "<br>";
            echo "<script>alert('Error deleting course.');</script>";
        }
    } else {
        echo "<script>alert('Invalid CourseID.');</script>";
    }
}

$select = "SELECT * FROM course";
$result = $connection->query($select);

if ($result->num_rows > 0) {
    while ($row = $result->fetch_assoc()) {
        // CourseID değerini kontrol et
        $courseID = isset($row["CourseID"]) ? $row["CourseID"] : '';

        echo "<tr>
            <td style='color: white;'>" . $courseID . "</td>
            <td style='color: white;'>" . $row["CourseName"] . "</td>
            <td>
                <form method='post' onsubmit='return confirmDelete();'>
                    <input type='hidden' name='id_to_delete' value='" . $courseID . "'>
                    <input type='submit' name='delete_button' value='Delete' class='ed'>
                </form>
            </td>
        </tr>";
    }
} else {
    echo "<tr><td colspan='3'>0 results</td></tr>";
}
?>
